# MobileMonitor

一个 Android 应用使用监控和限制工具，可以帮助您管理应用使用时间和访问频率。

## 功能特性

- 📊 **应用使用统计** - 查看每日/每周/每月的应用使用时长和次数
- 🚫 **应用访问限制** - 为特定应用设置使用规则（时间段、使用时长、访问次数）
- ⏰ **时间段控制** - 按星期几和时间段设置不同的限制规则
- 🔒 **实时拦截** - 当应用违反限制规则时自动拦截并显示提示界面

## 系统要求

- Android 6.0 (API 23) 或更高版本
- 建议 Android 8.0 (API 26) 或更高版本以获得最佳体验

## 安装和配置

### 1. 安装应用

从源代码构建并安装应用到您的 Android 设备。

### 2. 启用无障碍服务 ⚠️

**这是应用正常工作的必要步骤！**

应用需要使用无障碍服务 (Accessibility Service) 来监控应用启动事件。请按以下步骤启用：

#### 原生 Android / Pixel 设备

1. 打开 **设置** > **无障碍**
2. 找到 **已安装的服务** 或 **下载的服务**
3. 找到并点击 **MobileMonitor**
4. 打开开关启用服务
5. 在弹出的对话框中点击 **允许** 或 **确定**

#### MIUI (小米/红米) 设备

1. 打开 **设置** > **更多设置** > **无障碍**
2. 找到 **已安装的服务**
3. 找到并点击 **MobileMonitor**
4. 打开开关启用服务
5. 在弹出的对话框中点击 **允许**

#### 其他定制系统

路径可能略有不同，通常在：
- **设置** > **辅助功能** > **已安装的服务**
- **设置** > **无障碍** > **服务**

### 3. 授予必要权限

为了正常拦截应用，需要授予以下权限：

#### 必需权限

1. **使用情况访问权限 (Usage Access)**
   - 用于统计应用使用时长和次数
   - 路径：**设置** > **应用** > **特殊应用权限** > **使用情况访问权限** > **MobileMonitor** > 开启

2. **显示悬浮窗 / 在其他应用上层显示 (Display over other apps)**
   - 用于在受限应用上显示拦截界面
   - 路径：**设置** > **应用** > **特殊应用权限** > **显示在其他应用的上层** > **MobileMonitor** > 开启

#### MIUI 额外权限 ⚠️

如果您使用的是 MIUI 系统（小米/红米设备），还需要额外授予：

1. **后台弹出界面**
   - 路径：**设置** > **应用管理** > **MobileMonitor** > **权限管理** > **后台弹出界面** > 允许

2. **自启动** (建议)
   - 路径：**设置** > **应用管理** > **MobileMonitor** > **自启动** > 开启
   - 这可以确保服务在系统重启后自动运行

#### 其他定制系统

某些定制系统（如 OPPO ColorOS、vivo FuntouchOS 等）可能也有类似的限制，如果应用拦截功能不工作，请检查：
- **后台管理** / **后台自启动**
- **悬浮窗权限**
- **应用权限管理**

### 4. 验证配置

配置完成后，您可以通过以下方式验证：

1. 在应用中为某个应用（如浏览器）添加限制规则
2. 尝试打开该应用
3. 如果配置正确，应该会看到拦截界面而不是应用正常启动

## 使用说明

### 添加应用限制规则

1. 在主界面选择 **应用限制** 标签
2. 点击要限制的应用
3. 点击 **添加规则** 按钮
4. 设置规则参数：
   - **星期几**：选择规则生效的日期
   - **时间段**：设置规则生效的时间范围
   - **总使用时长**：该时间段内允许的最大使用时长（分钟）
   - **总访问次数**：该时间段内允许的最大打开次数
5. 点击 **保存** 保存规则

### 管理规则

- 点击规则可以查看详情
- 长按规则可以删除
- 可以为同一个应用添加多条规则（不同时间段）

### 全局监控开关

在 **设置** 页面可以找到全局监控开关：
- 开启：所有规则生效，违反规则的应用会被拦截
- 关闭：所有规则暂停，应用可以正常使用

## 故障排除

### 应用拦截不生效

1. **检查无障碍服务是否启用**
   - 进入系统设置的无障碍服务页面确认 MobileMonitor 已启用
   
2. **检查权限**
   - 确认已授予"显示悬浮窗"权限
   - MIUI 用户确认已授予"后台弹出界面"权限

3. **查看日志**
   - 使用 `adb logcat -s AppMonitoringService` 查看服务日志
   - 检查是否有权限相关的错误信息

4. **重启应用或设备**
   - 某些情况下需要重启应用或设备使配置生效

### 无障碍服务自动关闭

某些系统（特别是 MIUI）可能会在清理内存时关闭无障碍服务。解决方法：
- 将应用加入省电白名单
- 开启自启动权限
- 锁定应用不被清理

## 技术架构

- **语言**: Kotlin
- **UI 框架**: Jetpack Compose
- **架构**: MVVM + Repository 模式
- **数据库**: Room
- **核心技术**: 
  - AccessibilityService - 监控应用启动
  - UsageStatsManager - 统计应用使用数据
  - Coroutines + Flow - 异步处理

## 开发和构建

```bash
# 克隆项目
git clone <repository-url>

# 使用 Android Studio 打开项目
# 等待 Gradle 同步完成

# 构建并运行
./gradlew installDebug

# 或在 Android Studio 中点击 Run 按钮
```

## 许可证

[添加您的许可证信息]

## 贡献

欢迎提交 Issue 和 Pull Request！

## 注意事项

⚠️ **隐私说明**：本应用仅在本地设备上收集和存储使用数据，不会上传到任何服务器。

⚠️ **电池使用**：无障碍服务会持续在后台运行，可能会增加一定的电池消耗。

⚠️ **系统兼容性**：不同厂商的定制系统可能有不同的限制策略，如遇问题请参考故障排除部分。
